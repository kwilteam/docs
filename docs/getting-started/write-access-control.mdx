---
sidebar_position: 3
sidebar_label: "Write Access Control"
id: 'write-access-control'
title: "Write Access Control"
description: Set access control rules for writing to your database.
---

In this tutorial, we will modify the schema in the first [schema tutorial](/docs/getting-started/create-a-database) to add write access control rules.

Out of the box, Kwil supports a variety of access control capabilities. If you wish to implement more advances access control logic than what is natively available, you can do so by adding an [Extension](/docs/getting-started/using-extensions) to your network.

## Raising Errors

In an action, you can use SQL `CASE` statements to raise errors if certain conditions are not met. If an error is raised, the transaction will fail entirely, and data will not be written to the network.

```sql title="social_media.kf"
// private action to check if user exists
action check_user() private view {
    SELECT
        CASE
            WHEN NOT EXISTS (SELECT 1 FROM users WHERE address=@caller) THEN ERROR('User does not exist')
            ELSE null
        END as user_status;
}
```


## Action Privacy

Action privacy enforces whether an action can be called by a user or not. Public actions can be called by users. Private actions can only be called by other actions.

The distinction between public and private actions are similar to the distinction between public and private methods in object-oriented programming, where public methods are accessible from outside the class, and private methods are only accessible from within the class.

```sql title="social_media.kf"
// private action to check if user exists
action check_user() private {
    SELECT
        CASE
            WHEN NOT EXISTS (SELECT 1 FROM users WHERE address=@caller) THEN ERROR('User does not exist')
            ELSE null
        END
    FROM users;
}

// before creating a post, check if the user exists
action create_post ($id, $title, $content, $date_string) public {
    check_user();
    INSERT INTO posts (id, title, content, author_id, post_date)
    VALUES (
        $id, 
        $title, 
        $content,
        (SELECT id FROM users WHERE address=@caller), 
        $date_string
    );
}
```

## Owner-only Actions

Actions can be given an `owner` privacy level, which means that only the owner of the database can call the action. This is useful for actions that should only be called by the database owner, such as admin operations.

```sql title="social_media.kf"
// owner only action to delete a user
action delete_user($user_id) owner {
    DELETE FROM users WHERE id = $user_id;
}
```

## Full Example

The full Kuneiform schema for this tutorial can be found in the dropdown below.

<details>
  <summary> social_media.kf </summary>

```sql showLineNumbers
database social_media;

// table for storing application users
table users {
    id int primary,
    username text notnull unique minlen(5) maxlen(32),
    age int notnull max(120),
    address text notnull unique // user wallet addresses
}

// table for storing posts
table posts {
    id int primary,
    title text notnull maxlen(300),
    content text notnull maxlen(10000),
    author_id int notnull,
    post_date text notnull
}

// a public action for creating a user
// it will automatically include the wallet address
// of the caller in the "address" column
action create_user ($id, $username, $age) public {
    INSERT INTO users (id, username, age, address)
    VALUES ($id, $username, $age, @caller);
}

// a public action for updating mutable user data
action update_user ($username, $age) public {
    UPDATE users
    SET username=$username, age=$age
    WHERE address=@caller;
}

// private action to check if user exists
action check_user() private view {
    SELECT
        CASE
            WHEN NOT EXISTS (SELECT 1 FROM users WHERE address=@caller) THEN ERROR('User does not exist')
            ELSE null
        END as user_status;
}

// before creating a post, check if the user exists
// will raise an error if the user does not exist
action create_post ($id, $title, $content, $date_string) public {
    check_user();
    INSERT INTO posts (id, title, content, author_id, post_date)
    VALUES (
        $id, 
        $title, 
        $content,
        (SELECT id FROM users WHERE address=@caller), 
        $date_string
    );
}

action get_user ($username) public view {
    SELECT *
    FROM users
    WHERE username=$username;
}

// owner only action to delete a user
action delete_user($user_id) owner {
    DELETE FROM users WHERE id = $user_id;
}
```
</details>
