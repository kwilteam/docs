---
sidebar_position: 2
sidebar_label: "Step 2. Using The Database"
id: hello-world-using-the-database
title: Using The Database
description: Using the database for the hello world application!
slug: /tutorials/hello-world/using-the-database
---

Now that the database has been deployed, we can begin interacting with it through the Kwil Javascript / Typescript SDK.

## Prerequisites

Ensure you have the [Kwil JS SDK](https://www.npmjs.com/package/@kwilteam/kwil-js) and [EtherJS](https://docs.ethers.org/v6/) downloaded by running:

```zsh
npm i @kwilteam/kwil-js ethers
```

Check the local chain id by running:

```bash
curl http://localhost:8080/api/v1/chain_info
# {
#   "chain_id": "some_id",
#   "height": "123",
#   "hash": "abc123"
#}
```

## Initialize Kwil Client

Before we can interact with our database, we must first initialize a Kwil client. Note there is a slight difference between the NodeJS and Browser clients.

We will also declare the database ID (DBID) and and create the `KwilSigner` that can be used within the rest of the application. A DBID is a unique identifier for a database generated from the databse owner's public key and database name.

If needed, you can recover your [Secp256k1 public key](/docs/sdks/js-ts/overview#public-keys) with the recovery [utility function](/docs/sdks/js-ts/apis#generatedbid).

:::tip

You can find a list of public Kwil providers [here](../../links).

:::

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

<Tabs
    defaultValue="node"
    values={[
        { label: 'NodeJs', value: 'node', },
        { label: 'Browser', value: 'browser', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="node">

```js title="setup.js" {7}
const { NodeKwil, KwilSigner, Utils } = require("@kwilteam/kwil-js");
const { Wallet } = require("ethers");

async function setup() {
    const kwil = new NodeKwil({
        kwilProvider: "http://localhost:8080",
        chainId: "some_id", // Use the chain id from the local chain
    });

    const ethersWallet = new Wallet("<ethereum-private-key>"); // Use your own private key here

    const publicKey = await Utils.recoverSecp256k1PubKey(ethersWallet);
    const databaseName = "hello_world";

    const dbid = Utils.generateDBID(publicKey, databaseName);

    const kwilSigner = new KwilSigner(ethersWallet, publicKey);

    return {
        kwil,
        dbid,
        kwilSigner,
    };
}

module.exports = setup;
```

</TabItem>
<TabItem value="browser">

```js title="setup.js" {7}
import { WebKwil, KwilSigner, Utils } from "@kwilteam/kwil-js";
import { BrowserProvider } from "ethers";

export default async function setup() {
    const kwil = new WebKwil({
        kwilProvider: "http://localhost:8080",
        chainId: "some_id", // Use the chain id from the local chain
    });

    const provider = new BrowserProvider(window.ethereum);
    const ethersSigner = await provider.getSigner();

    const publicKey = await Utils.recoverSecp256k1PubKey(ethersSigner);
    const databaseName = "hello_world";

    const dbid = Utils.generateDBID(publicKey, databaseName);

    const kwilSigner = new KwilSigner(ethersSigner, publicKey);

    return {
        kwil,
        dbid,
        kwilSigner,
    };
}
```

</TabItem>
<TabItem value="ts">

```ts title="setup.ts" {7}
import { WebKwil, KwilSigner, Utils } from "@kwilteam/kwil-js";
import { BrowserProvider, Signer } from "ethers";

export default async function setup() {
    const kwil: WebKwil = new WebKwil({
        kwilProvider: "http://localhost:8080",
        chainId: "some_id", // Use the chain id from the local chain
    });

    const provider: BrowserProvider = new BrowserProvider(window.ethereum);
    const ethersSigner: Signer = await provider.getSigner();

    const publicKey: string = await Utils.recoverSecp256k1PubKey(ethersSigner);
    const databaseName: string = "hello_world";

    const dbid: string = Utils.generateDBID(publicKey, databaseName);

    const kwilSigner: KwilSigner = new KwilSigner(ethersSigner, publicKey);

    return {
        kwil,
        dbid,
        kwilSigner,
    };
}
```

</TabItem>
</Tabs>

:::tip

The Kwil SDK is compatible with [Ethers v5](https://docs.ethers.org/v5/) and [Ethers v6](https://docs.ethers.org/v6/).

:::

## Execute Actions

Now, we can begin executing the actions defined in the previous [step](./creating-the-database).

### insert_greeting

Let's start by adding data to the database. We can add a record by calling the `insert_greeting` action.

First begin by constructing the action inputs with the `ActionInput` class. Then, build the action transaction with the `ActionBuilder` class. Finally, call the `kwil.broadcast()` method to broadcast the transaction to the Kwil network.

The DBID is a unique identifier for the database. You can find the DBID by calling the `Utils.generateDBID()` method.

The signer used to sign the transaction is an Ethereum signer. In this example, we are using the [ethers](https://docs.ethers.io/v6/) library to create a signer in node and browers.

<Tabs
    defaultValue="node"
    values={[
        { label: 'NodeJs', value: 'node', },
        { label: 'Browser', value: 'browser', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="node">

```js title="insert_greeting.js"
const setup = require("./setup");
const { Utils } = require("@kwilteam/kwil-js");

async function addGreeting(id, msg) {
    const { kwil, dbid, kwilSigner } = await setup();

    const input = new Utils.ActionInput().put("$id", id).put("$message", msg);

    const actionBody = {
        dbid,
        action: "insert_greeting",
        inputs: [input],
        description: "Inserts a greeting into the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
}

addGreeting(1, "Hello World!");
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
<TabItem value="browser">

```js title="insert_greeting.js"
import setup from "./setup";
import { Utils } from "@kwilteam/kwil-js";

async function addGreeting(id, msg) {
    const { kwil, dbid, kwilSigner } = await setup();

    const input = new Utils.ActionInput().put("$id", id).put("$message", msg);

    const actionBody = {
        dbid,
        action: "insert_greeting",
        inputs: [input],
        description: "Inserts a greeting into the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
}

addGreeting(1, "Hello World!");
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
<TabItem value="ts">

```ts title="insert_greeting.ts"
import setup from "./setup";
import { Utils, Types } from "@kwilteam/kwil-js";

async function addGreeting(id: number, msg: string): Promise<Types.GenericResponse<Types.TxReceipt>> {
    const { kwil, dbid, kwilSigner } = await setup();

    const input: Types.ActionInput = new Utils.ActionInput().put("$id", 1).put("$message", "Hello World!");

    const actionBody: Types.ActionBody = {
        dbid,
        action: "insert_greeting",
        inputs: [input],
        description: "Inserts a greeting into the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
    return res;
}

addGreeting(1, "Hello World!");
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
</Tabs>

Once this action has been executed, the database will contain the following data:

```zsh
| id |   message    |                   wallet                   |
+----+--------------+--------------------------------------------+
|  1 | Hello World! | 0xAfFDC06cF34aFD7D5801A13d48C92AD39609901D |
```

### select_greetings

To retrieve data from the database, we can call the `select_greetings` action. Because `select_greeting` is a `view` action, we will build a message and pass it to the `kwil.call()` API.

<Tabs
    defaultValue="node"
    values={[
        { label: 'NodeJs', value: 'node', },
        { label: 'Browser', value: 'browser', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="node">

```js title="select_greetings.js"
const setup = require("./setup");

async function readGreetings() {
    const { kwil, dbid } = await setup();

    const actionBody = {
        dbid,
        action: "select_greetings",
    };

    const res = await kwil.call(actionBody);
    console.log(res);
}

readGreetings();
/*
    {
        status: 200,
        data: {
            result: [ { id: 1, message: 'Hello World!', wallet: '<your_wallet_address>'} ]
        }
    }
*/
```

</TabItem>
<TabItem value="browser">

```js title="select_greetings.js"
import setup from "./setup";

async function readGreetings() {
    const { kwil, dbid } = await setup();

    const actionBody = {
        dbid,
        action: "select_greetings",
    };

    return await kwil.call(actionBody);
}

readGreetings();
/*
    {
        status: 200,
        data: {
            result: [ { id: 1, message: 'Hello World!', wallet: '<your_wallet_address>'} ]
        }
    }
*/
```

</TabItem>
<TabItem value="ts">

```ts title="select_greetings.ts"
import setup from "./setup";
import { Types } from "@kwilteam/kwil-js";

async function readGreetings(): Promise<Types.GenericResponse<Types.MsgReceipt>> {
    const { kwil, dbid } = await setup();

    const actionBody: Types.ActionBody = {
        dbid,
        action: "select_greetings",
    };

    return await kwil.call(actionBody);
    return res;
}

readGreetings();
/*
    {
        status: 200,
        data: {
            result: [ { id: 1, message: 'Hello World!', wallet: '<your_wallet_address>'} ]
        }
    }
*/
```

</TabItem>
</Tabs>

### update_greeting

To update data in the database, we can call the `update_greeting` action. As defined, this action will update the message field of the greetings table.

This action follows the same process as the `insert_greeting` [action](#insert_greeting), requiring us to construct an `ActionBody` object and pass it to the `kwil.execute()` method.

<Tabs
    defaultValue="node"
    values={[
        { label: 'NodeJs', value: 'node', },
        { label: 'Browser', value: 'browser', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="node">

```js title="update_greeting.js"
const setup = require("./setup");
const { Utils } = require("@kwilteam/kwil-js");

async function updateGreeting(id, msg) {
    const { kwil, dbid, kwilSigner } = await setup();

    const input = new Utils.ActionInput().put("$id", id).put("$message", msg);

    const actionBody = {
        dbid,
        action: "update_greeting",
        inputs: [input],
        description: "Updates a greeting in the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
}

updateGreeting(1, "Hello Kwil!");
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
<TabItem value="browser">

```js title="update_greeting.js"
import setup from "./setup";
import { Utils } from "@kwilteam/kwil-js";

async function updateGreeting(id, msg) {
    const { kwil, dbid, kwilSigner } = await setup();

    const input = new Utils.ActionInput().put("$id", id).put("$message", msg);

    const actionBody = {
        dbid,
        action: "update_greeting",
        inputs: [input],
        description: "Updates a greeting in the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
}

updateGreeting(1, "Hello Kwil!");
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
<TabItem value="ts">

```ts title="update_greeting.ts"
import setup from "./setup";
import { Utils, Types } from "@kwilteam/kwil-js";

async function updateGreeting(id: number, msg: string): Promise<Types.GenericResponse<Types.TxReceipt>> {
    const { kwil, dbid, kwilSigner } = await setup();

    const input: Utils.ActionInput = new Utils.ActionInput().put("$id", id).put("$message", msg);

    const actionBody: Types.ActionBody = {
        dbid,
        action: "update_greeting",
        inputs: [input],
        description: "Updates a greeting in the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
    return res;
}

updateGreeting(1, "Hello Kwil!");
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
</Tabs>

Once this transaction is executed, the database will be updated with the new message.

```zsh
| id |   message   |                   wallet                   |
+----+-------------+--------------------------------------------+
|  1 | Hello Kwil! | 0xAfFDC06cF34aFD7D5801A13d48C92AD39609901D |
```

### delete_greeting

To delete record in the database, we can call the `delete_greeting` action. As defined, this action will delete the record for a specific id and wallet address.

Again, this action follows the same process as the `insert_greeting` [action](#insert_greeting) and `update_greeting` [action](#update_greeting)

<Tabs
    defaultValue="node"
    values={[
        { label: 'NodeJs', value: 'node', },
        { label: 'Browser', value: 'browser', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="node">

```js title="delete_greeting.js"
const setup = require("./setup");
const { Utils } = require("@kwilteam/kwil-js");

async function deleteGreeting(id) {
    const { kwil, dbid, kwilSigner } = await setup();

    const input = new Utils.ActionInput().put("$id", id);

    const actionBody = {
        dbid,
        action: "delete_greeting",
        inputs: [input],
        description: "Deletes a greeting from the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
}

deleteGreeting(1);
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
<TabItem value="browser">

```js title="delete_greeting.js"
import setup from "./setup";
import { Utils } from "@kwilteam/kwil-js";

async function deleteGreeting(id) {
    const { kwil, dbid, kwilSigner } = await setup();
    
    const input = new Utils.ActionInput().put("$id", id);

    const actionBody = {
        dbid,
        action: "delete_greeting",
        inputs: [input],
        description: "Deletes a greeting from the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
}

deleteGreeting(1);
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
<TabItem value="ts">

```ts title="delete_greeting.ts"
import setup from "./setup";
import { Utils, Types } from "@kwilteam/kwil-js";
import { BrowserProvider, Signer } from "ethers";

async function deleteGreeting(id): Promise<Types.GenericResponse<Types.TxReceipt>> {
    const { kwil, dbid, kwilSigner } = await setup();

    const input: Utils.ActionInput = new Utils.ActionInput().put("$id", id);

    const actionBody: Types.ActionBody = {
        dbid,
        action: "delete_greeting",
        inputs: [input],
        description: "Deletes a greeting from the database",
    };

    const res = await kwil.execute(actionBody, kwilSigner);
    console.log(res);
    return res;
}

deleteGreeting(1);
/*
    res = {
        status: 200,
        data: {
            tx_hash: 'abc123...'
        }
    }
*/
```

</TabItem>
</Tabs>

Once this transaction is executed, the record will be deleted from the database.

## Read-Only Queries

In addition to using `view` actions to read data from the database, we can also use write SELECT queries.

To execute a read-only query, we can use the `selectQuery` method on the `kwil` object. This method takes in a `dbid` and a `query` as parameters. The `query` parameter is a string that contains a valid SQL SELECT query.

For example, to read all records by a user's wallet address, we can use the following:

<Tabs
    defaultValue="node"
    values={[
        { label: 'NodeJs', value: 'node', },
        { label: 'Browser', value: 'browser', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="node">

```js title="select_query.js"
const setup = require("./setup");

async function selectQuery() {
    const { kwil, dbid, kwilSigner } = await setup();
    
    const res = await kwil.selectQuery(
        dbid, 
        `SELECT * FROM greetings WHERE wallet = '${kwilSigner.signer.address}'`
    );
    
    console.log(res);
}

selectQuery();
/* 
    res = {
        status: 200,
        data: [
            {
                "id": 1,
                "message": "Hello World!",
                "wallet": "<your-wallet-address>"
            }
        ]
    }
*/
```

</TabItem>
<TabItem value="browser">

```js title="select_query.js"
import setup from "./setup";

async fuynction selectQuery() {
    const { kwil, dbid, kwilSigner } = await setup();
    
    const res = await kwil.selectQuery(
        dbid, 
        `SELECT * FROM greetings WHERE wallet = '${kwilSigner.signer.address}'`
    );
    
    console.log(res);
}

selectQuery();
/*
    res = {
        status: 200,
        data: [
            {
                "id": 1,
                "message": "Hello World!",
                "wallet": "<your-wallet-address>"
            }
        ]
    }
*/
```

</TabItem>
<TabItem value="ts">

```ts title="select_query.ts"
import setup from "./setup";
import { Types } from "@kwilteam/kwil-js";
import { BrowserProvider, Signer } from "ethers";

const publicKey: string = kwilSigner.publicKey;

async function selectQuery(id, query): Promise<Types.GenericResponse<Types.SelectReceipt>> {
    const { kwil, dbid, kwilSigner } = await setup();
    
    const res = await kwil.selectQuery(
        dbid, 
        `SELECT * FROM greetings WHERE wallet = '${kwilSigner.signer.address}'`
    );

    console.log(res);
    return res;
}

selectQuery();
/*
    res = {
        status: 200,
        data: [
            {
                "id": 1,
                "message": "Hello World!",
                "wallet": "<your-wallet-address>"
            }
        ]
    }
*/
```

</TabItem>
</Tabs>

## Database Metadata

You can also view database metadata by calling the `getSchema` method on the `kwil` object. This method takes in a `dbid` as a parameter and returns a `Database` object. This is helpful for viewing database information such as tables, indexes, and actions.

Note that there is no difference between NodeJs and Browser usage for this method, except that the initial `kwil` object must have been instantiated with `WebKwil` or `NodeKwil` depending on your environment.

<Tabs
    defaultValue="js"
    values={[
        { label: 'Javascript', value: 'js', },
        { label: 'Typescript', value: 'ts', },
    ]}
>
<TabItem value="js">

```js title="get_schema.js"
const setup = require("./setup");

async function getSchema() {
    const { kwil, dbid } = await setup();
    const res = await kwil.getSchema(dbid);
    console.log(res);
}

getSchema();
/*
    res = {
        status: 200,
        data: {
            name: 'hello_world',
            owner: <your-public-key>,
            tables: [ [Object] ],
            actions: [ [Object], [Object], [Object], [Object] ],
            extensions: [ [Object] ]
        }
    }
*/
```

</TabItem>
<TabItem value="ts">

```ts title="get_schema.ts"
import setup from "./setup";
import { Types } from "@kwilteam/kwil-js";

async function getSchema(): Promise<Types.GenericResponse<Types.Database<string>>> {
    const { kwil, dbid } = await setup();
    const res = await kwil.getSchema(dbid);
    console.log(res);
    return res;
}

getSchema();
/*
    res = {
        status: 200,
        data: {
            name: 'hello_world',
            owner: <your-wallet-address>,
            tables: [ [Object] ],
            actions: [ [Object], [Object], [Object], [Object] ],
            extensions: [ [Object] ]
        }
    }
*/
```

</TabItem>
</Tabs>

You can also use the Kwil SDK to query other metadata related to database owners and accounts. A list of the full SDK functionality can be found in the [JavaScript/TypeScript SDK](/docs/sdks/js-ts/overview) section.

## Next Steps

You have now reached the end of the Hello World tutorial! From here, you can jump into any of the following guides to continue learning:

-   [Example 2: Building a Social Media Application with Kwil](/docs/category/tutorial-2-social-app)
-   [Kuneiform Language Reference](/docs/kuneiform/introduction)
-   [Kwil Supported SQL Syntax](/docs/category/sql-as-understood-by-kwil)
-   [JavaScript/TypeScript SDK](/docs/sdks/js-ts/overview)
-   [Python SDK](/docs/sdks/python/overview)
