---
sidebar_position: 1
sidebar_label: "Network Snapshots"
id: network-snapshots
title: Network Snapshots
description: "Preparing snapshots for offline network migration"
slug: /node/migrations/offline-migrations/network-snapshots
---

Kwild supports creating network snapshots, which captures the state of the application at a specific point in time. These network snapshots can be used to initialize a new network with the same state as the existing network at the time of the snapshot, which makes them useful for network migrations and upgrades. These snapshots include data related to user-deployed schemas, accounts, processed votes on resolutions and more. 

## Create Snapshot
Network snapshots can be generated using the [kwil-admin snapshot create](/docs/ref/kwil-admin/snapshot/create) command.
This tool connects directly to the database to download its state and does not require the `kwild` process to be running.

```sh
kwil-admin snapshot create --snapdir /path/to/snapdir
```

This generates a compressed snapshot file and a template genesis file required to start the new network as shown below.

```sh
$ ls /path/to/snapdir
genesis.json            kwildb-snapshot.sql.gz
```

:::tip
By default, the `snapshot create` command connects to the `postgres` instance running at `localhost:5432` with the default user `postgres` (without a password?). To modify the database connection settings, see the `kwil-admin` reference page.
:::

## Genesis File

The generated genesis file includes the genesis app hash, derived from the hash of the uncompressed snapshot file, and the genesis validators set to the validators from the previous network. 

:::warning
The rest of the configuration in the genesis file is set to defaults, so you should update it based on your requirements before starting a new network with it.
:::

```json
{
  "chain_id": "kwil-chain-XQ7j4ARv",
  "initial_height": 1,
  "app_hash": "TC7PwUXDekWh/SHNOO6E24DYUplvwwQ4oAe6YkOHxoM=",  // app hash derived from the snapshot
  "allocs": null,
  "activations": null,
  "consensus_params": {
    ...  // set to defaults
  },
  "validators": [ // validators from the previous network
    {
      "pub_key": "ec37fc333b52b139ebb1176612900a82937a708a61e99c6c657f0ffe18f8f6f0",
      "power": 1,
      "name": "validator-0"
    }
  ]
}
```
### Verify App Hash

The app hash set in the genesis file is generated based on the hash of the uncompressed snapshot. You can verify the app hash in the generated genesis file as follows

``` bash
# app_hash in the genesis file is a base64 representation of the sha256 hash value
# hex-> binary -> base64
$ gunzip -c /path/to/snapdir/kwildb-snapshot.sql.gz | shasum -a 256 | xxd -r -p | base64
TC7PwUXDekWh/SHNOO6E24DYUplvwwQ4oAe6YkOHxoM=
```

```bash
# compare the app hash with the genesis file
$ jq -r '.app_hash' /path/to/snapdir/genesis.json
TC7PwUXDekWh/SHNOO6E24DYUplvwwQ4oAe6YkOHxoM=
```